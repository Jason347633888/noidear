# 文档管理系统 - 前端交互设计规范

> **版本**: 1.1
> **最后更新**: 2026-02-13
> **文档行数**: ~1,900 行
> **技术栈**: Vue 3 + Element Plus + TypeScript
> **设计参考**: SPMS-Web + Material Design + Apple HIG
> **新增内容**: UI 状态管理、快捷键、动画、可访问性、异常处理、响应式设计

---

## 目录

1. [全局设计规范](#全局设计规范)
2. [模块 1: 文档管理](#模块-1-文档管理)
3. [模块 2: 模板管理](#模块-2-模板管理)
4. [模块 3: 任务管理](#模块-3-任务管理)
5. [模块 4: 审批流程](#模块-4-审批流程)
6. [模块 5: 权限管理](#模块-5-权限管理)
7. [模块 6: 回收站](#模块-6-回收站)
8. [模块 7: 通知系统](#模块-7-通知系统)
9. [附录 1: 组件库规范](#附录-组件库规范)
10. [附录 2: UI 状态管理规范](#附录-2-ui-状态管理规范)
11. [附录 3: 快捷键支持](#附录-3-快捷键支持)
12. [附录 4: 动画与过渡效果](#附录-4-动画与过渡效果)
13. [附录 5: 可访问性（Accessibility）规范](#附录-5-可访问性accessibility规范)
14. [附录 6: 异常处理规范](#附录-6-异常处理规范)
15. [附录 7: 响应式设计规范](#附录-7-响应式设计规范)

---

## 全局设计规范

### 颜色系统

**状态颜色**
- `草稿`: #909399 (灰色 - info)
- `审核中`: #E6A23C (橙色 - warning)
- `已发布`: #67C23A (绿色 - success)
- `已驳回`: #F56C6C (红色 - danger)
- `已归档`: #409EFF (蓝色 - primary)

**按钮颜色**
- `主按钮 (Primary)`: #409EFF
- `成功按钮 (Success)`: #67C23A
- `警告按钮 (Warning)`: #E6A23C
- `危险按钮 (Danger)`: #F56C6C
- `信息按钮 (Info)`: #909399

### 间距系统

- `xs`: 4px - 超小间距
- `sm`: 8px - 小间距
- `md`: 16px - 中间距
- `lg`: 24px - 大间距
- `xl`: 32px - 超大间距

### 字体系统

- `xs`: 12px - 辅助文字
- `sm`: 14px - 正文
- `md`: 16px - 小标题
- `lg`: 18px - 标题
- `xl`: 20px - 大标题

### 对话框尺寸规范

| 类型 | 宽度 | 高度 | 用途 |
|------|------|------|------|
| 编辑对话框 | 80% | 80% | 文档编辑、模板编辑 |
| 详情对话框 | 70% | 80% | 文档详情查看 |
| 选择对话框 | 60% | 70% | 选择审批人、选择部门 |
| 预览对话框 | 90% | 90% | PDF/Word 预览 |
| 确认对话框 | 自适应 | 自适应 | 删除确认、操作确认 |

---

## 模块 1: 文档管理

### 1.1 文档列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 文档管理                                    [+ 新建文档] [导出]  │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 状态: [全部▼] 部门: [全部▼] [搜索][重置] │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 文档名称     │ 文档编号  │ 状态   │ 创建人 │ 创建时间 │ 操作 │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 质量手册V2.0 │ DOC-001  │ 已发布  │ 张三   │ 2026-01  │ [...] │ │
│ │ 程序文件汇编  │ DOC-002  │ 审核中  │ 李四   │ 2026-01  │ [...] │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 150 条  [1][2][3]...[10]  10条/页 ▼                          │
└─────────────────────────────────────────────────────────────────┘
```

#### 顶部操作按钮

**位置**: 页面右上角  
**顺序** (从左到右):
1. `[+ 新建文档]` - 主按钮 (type="primary")
2. `[导出]` - 次要按钮 (type="default")

**按钮状态**:
- **新建文档**: 始终启用
- **导出**: 有数据时启用，列表为空时禁用

#### 操作列按钮

**列宽**: 160px  
**顺序** (从左到右):
1. `[编辑]` - 链接按钮 (link type="primary")
2. `[删除]` - 链接按钮 (link type="danger")
3. `[详情]` - 链接按钮 (link)
4. `[预览]` - 链接按钮 (link)
5. `[下载]` - 链接按钮 (link)

**按钮状态映射表**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 编辑 | (状态=草稿 且 当前用户=创建者) 或 当前用户=管理员 | 状态=已发布/审核中 |
| 删除 | 当前用户=创建者 或 当前用户=管理员 | 其他用户 |
| 详情 | 始终启用 | - |
| 预览 | 文档已上传 | 文档未上传 |
| 下载 | 文档已上传 | 文档未上传 |

#### 交互流程

**流程 1: 新建文档**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"新建文档" | 弹出编辑对话框 (80%×80%)
2    | 选择文档级别 (一/二/三) | 动态加载对应字段
3    | 填写文档名称 (必填) | 实时验证
4    | 填写文档编号 (选填) | 自动生成建议值 (DOC-2026-001)
5    | 选择所属部门 (必填) | 部门树选择器
6    | 上传文档文件 (必填) | 上传到 MinIO，显示进度条
7    | 点击"确定" | 验证 → 提交 → 关闭对话框 → 刷新列表 → 绿色 Toast "文档创建成功"
```

**流程 2: 编辑文档**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"编辑" | 检查权限 → 有权限: 弹出编辑对话框，加载数据 / 无权限: 橙色 Toast "无编辑权限"
2    | 修改字段 | 实时验证
3    | 点击"确定" | 提交 → 刷新列表 → 绿色 Toast "修改成功"
```

**流程 3: 删除文档**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"删除" | 弹出确认对话框: 标题"删除确认" / 内容"确定删除文档《质量手册V2.0》？删除后可在回收站恢复"
2    | 点击"确定" | 软删除 → 刷新列表 → 绿色 Toast "已移至回收站"
```

**流程 4: 搜索过滤**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 输入搜索关键词 | 实时搜索 (防抖 500ms)
2    | 选择状态筛选 | 立即过滤
3    | 选择部门筛选 | 立即过滤
4    | 点击"重置" | 清空所有筛选条件 → 显示全部数据
```

#### 状态标签

**显示方式**: `<el-tag :type="statusType">{{ statusLabel }}</el-tag>`

**状态映射**:
- `草稿` → `<el-tag type="info">草稿</el-tag>`
- `审核中` → `<el-tag type="warning">审核中</el-tag>`
- `已发布` → `<el-tag type="success">已发布</el-tag>`
- `已驳回` → `<el-tag type="danger">已驳回</el-tag>`
- `已归档` → `<el-tag type="primary">已归档</el-tag>`

---

### 1.2 文档编辑对话框

#### 页面布局

```
┌─────────────────────────────────────────────────┐
│ 新建文档                              [×]        │ ← 80%宽×80%高
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 基础信息                                     │ │
│ │ ┌───────────────┬───────────────┐           │ │
│ │ │ *文档名称:     │ *文档编号:     │           │ │ ← 2列布局
│ │ │ [___________] │ [___________] │           │ │
│ │ ├───────────────┼───────────────┤           │ │
│ │ │ *文档级别:     │ *所属部门:     │           │ │
│ │ │ [一级文件 ▼]  │ [部门树 ▼]    │           │ │
│ │ └───────────────┴───────────────┘           │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 文档文件                                     │ │
│ │ [选择文件] 或 拖拽文件到此处                 │ │ ← 1列全宽
│ │ 支持 PDF/Word/Excel，单个文件最大 10MB      │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 附加信息                                     │ │
│ │ 文档描述:                                    │ │ ← 1列全宽
│ │ [_______________________________________]   │ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                          [取消] [确定]          │
└─────────────────────────────────────────────────┘
```

#### 字段分组

**分组 1: 基础信息** (2列布局)
- **文档名称** (必填，文本输入，最大200字符)
- **文档编号** (选填，自动生成建议值如 DOC-2026-001)
- **文档级别** (必填，下拉选择: 一级/二级/三级)
- **所属部门** (必填，树形选择)

**分组 2: 文档文件** (1列全宽)
- **文件上传** (必填，拖拽或点击上传，支持 PDF/Word/Excel，最大10MB)

**分组 3: 附加信息** (1列全宽)
- **文档描述** (选填，多行文本，最大1000字符)

#### 验证规则

```typescript
const rules = {
  name: [
    { required: true, message: '请输入文档名称', trigger: 'blur' },
    { max: 200, message: '文档名称不能超过200字符', trigger: 'blur' }
  ],
  level: [
    { required: true, message: '请选择文档级别', trigger: 'change' }
  ],
  departmentId: [
    { required: true, message: '请选择所属部门', trigger: 'change' }
  ],
  fileId: [
    { required: true, message: '请上传文档文件', trigger: 'change' }
  ]
}
```

#### 文件上传流程

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"选择文件" 或 拖拽文件 | 打开文件选择器
2    | 选择文件 | 验证文件类型和大小 → 失败: 红色 Toast "文件类型不支持" / "文件过大" → 成功: 显示上传进度条
3    | 上传中 | 进度条更新 (0% → 100%)
4    | 上传完成 | 显示文件名和大小: [质量手册.pdf] [1.2MB] [×删除]
```

---

## 模块 2: 模板管理

### 2.1 模板列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 模板管理                                    [+ 新建模板] [导出]  │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 类型: [全部▼] [搜索][重置]               │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 模板名称       │ 模板编号 │ 字段数 │ 创建人 │ 创建时间 │ 操作 │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 生产记录表     │ TPL-001  │ 15    │ 张三   │ 2026-01  │ [...] │ │
│ │ 设备点检表     │ TPL-002  │ 20    │ 李四   │ 2026-01  │ [...] │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 50 条  [1][2][3]...[5]  10条/页 ▼                            │
└─────────────────────────────────────────────────────────────────┘
```

#### 操作列按钮

**列宽**: 180px  
**顺序** (从左到右):
1. `[编辑]` - 链接按钮
2. `[字段管理]` - 链接按钮
3. `[删除]` - 链接按钮 (危险色)
4. `[详情]` - 链接按钮

**按钮状态映射**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 编辑 | 当前用户=创建者 或 管理员 | 其他用户 |
| 字段管理 | 当前用户=创建者 或 管理员 | 其他用户 |
| 删除 | 模板未被使用 且 (当前用户=创建者 或 管理员) | 模板已被使用 |
| 详情 | 始终启用 | - |

---

### 2.2 字段管理对话框

#### 页面布局

```
┌─────────────────────────────────────────────────┐
│ 字段管理 - 生产记录表                  [×]       │ ← 90%宽×90%高
├─────────────────────────────────────────────────┤
│ [+ 新增字段]                                     │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 字段名称   │ 字段类型 │ 必填 │ 排序 │ 操作  │ │
│ ├─────────────────────────────────────────────┤ │
│ │ 生产日期   │ 日期     │ 是   │ 1   │ [...] │ │
│ │ 班次       │ 单选     │ 是   │ 2   │ [...] │ │
│ │ 产品名称   │ 文本     │ 是   │ 3   │ [...] │ │
│ │ 产量       │ 数字     │ 是   │ 4   │ [...] │ │
│ │ 备注       │ 多行文本 │ 否   │ 5   │ [...] │ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                          [关闭]                  │
└─────────────────────────────────────────────────┘
```

#### 字段类型

支持的字段类型（共 20+ 种）:
- **文本类型**: 单行文本、多行文本、富文本
- **数字类型**: 整数、小数、百分比、金额
- **选择类型**: 单选、多选、下拉框、级联选择
- **日期类型**: 日期、时间、日期时间、日期范围
- **文件类型**: 附件上传、图片上传
- **关联类型**: 用户选择、部门选择、产品选择、物料选择
- **其他类型**: 评分、开关、颜色选择器

#### 字段操作按钮

**操作列** (从左到右):
1. `[编辑]` - 链接按钮
2. `[上移]` / `[下移]` - 链接按钮
3. `[删除]` - 链接按钮 (危险色)

#### 交互流程

**流程 1: 新增字段**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"新增字段" | 弹出字段编辑对话框 (60%×70%)
2    | 填写字段名称 (必填) | 实时验证
3    | 选择字段类型 | 动态显示对应配置项
4    | 配置字段属性 (必填、默认值等) | 实时验证
5    | 点击"确定" | 添加到字段列表末尾 → 绿色 Toast "字段添加成功"
```

**流程 2: 编辑字段**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"编辑" | 弹出字段编辑对话框，加载字段数据
2    | 修改字段属性 | 实时验证
3    | 点击"确定" | 更新字段 → 绿色 Toast "字段修改成功"
```

**流程 3: 删除字段**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"删除" | 检查是否有填报记录 → 有记录: 弹出确认对话框 "该字段已有填报记录，删除后历史数据保留但不再显示，确定删除？" / 无记录: 直接弹出确认对话框 "确定删除该字段？"
2    | 点击"确定" | 删除字段 → 绿色 Toast "字段删除成功"
```

**流程 4: 字段排序**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"上移" / "下移" | 字段位置调整 → 自动保存
```

---

## 模块 3: 任务管理

### 3.1 任务列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 任务管理                                    [+ 新建任务] [导出]  │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 状态: [全部▼] 负责人: [全部▼] [搜索][重置] │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 任务名称       │ 模板   │ 负责人 │ 截止日期 │ 状态 │ 操作  │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 2月生产记录填报│ 生产..  │ 张三   │ 2026-02-28│ 进行中│ [...] │ │
│ │ 设备日常点检   │ 设备..  │ 李四   │ 2026-02-20│ 待开始│ [...] │ │
│ │ 1月生产记录填报│ 生产..  │ 张三   │ 2026-01-31│ 已完成│ [...] │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 120 条  [1][2][3]...[12]  10条/页 ▼                          │
└─────────────────────────────────────────────────────────────────┘
```

#### 任务状态

**状态类型**:
- `待开始` - 灰色 (info)
- `进行中` - 橙色 (warning)
- `已完成` - 绿色 (success)
- `已逾期` - 红色 (danger)

#### 操作列按钮

**列宽**: 160px  
**顺序** (从左到右):
1. `[填报]` - 链接按钮 (主色)
2. `[编辑]` - 链接按钮
3. `[删除]` - 链接按钮 (危险色)
4. `[详情]` - 链接按钮

**按钮状态映射**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 填报 | 状态=进行中 且 当前用户=负责人 | 状态=已完成 或 当前用户≠负责人 |
| 编辑 | 状态≠已完成 且 当前用户=创建者 | 状态=已完成 |
| 删除 | 状态=待开始 且 当前用户=创建者 | 状态≠待开始 |
| 详情 | 始终启用 | - |

---

### 3.2 任务填报对话框

#### 页面布局

```
┌─────────────────────────────────────────────────┐
│ 任务填报 - 2月生产记录填报            [×]       │ ← 90%宽×90%高
├─────────────────────────────────────────────────┤
│ 任务信息:                                        │
│ • 模板: 生产记录表                               │
│ • 负责人: 张三                                   │
│ • 截止日期: 2026-02-28                           │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 填报记录                                     │ │
│ │ [+ 新增记录]                                 │ │
│ │ ┌───────────────────────────────────────┐   │ │
│ │ │ 生产日期 │ 班次 │ 产品名称 │ 产量 │ 操作│   │ │
│ │ ├───────────────────────────────────────┤   │ │
│ │ │ 2026-02-01│ 早班│ 产品A   │ 100 │ [...] │   │ │
│ │ │ 2026-02-02│ 中班│ 产品B   │ 150 │ [...] │   │ │
│ │ └───────────────────────────────────────┘   │ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                    [保存草稿] [提交完成]        │
└─────────────────────────────────────────────────┘
```

#### 按钮说明

**底部按钮** (从左到右):
1. `[保存草稿]` - 次要按钮 (type="default")
   - 保存填报数据但不改变任务状态
   - 可多次保存
   
2. `[提交完成]` - 主按钮 (type="primary")
   - 提交填报数据并将任务状态改为"已完成"
   - 需要至少有 1 条填报记录

#### 交互流程

**流程 1: 新增记录**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"新增记录" | 弹出记录编辑对话框，根据模板字段动态生成表单
2    | 填写字段值 | 实时验证
3    | 点击"确定" | 添加到记录列表 → 绿色 Toast "记录添加成功"
```

**流程 2: 保存草稿**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"保存草稿" | 保存当前填报数据 → 绿色 Toast "草稿保存成功"
```

**流程 3: 提交完成**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"提交完成" | 验证至少有1条记录 → 无记录: 红色 Toast "请至少添加1条记录" → 有记录: 弹出确认对话框 "确定提交任务？提交后将无法修改"
2    | 点击"确定" | 提交填报数据 → 任务状态改为"已完成" → 关闭对话框 → 刷新列表 → 绿色 Toast "任务提交成功"
```

---

## 模块 4: 审批流程

### 4.1 审批列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 审批管理           [我发起的] [待我审批] [我已审批] [全部]      │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 状态: [全部▼] [搜索][重置]               │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 文档名称       │ 发起人 │ 当前审批人 │ 状态  │ 发起时间 │ 操作│ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 质量手册V2.0   │ 张三   │ 李四      │ 审核中│ 2026-02  │ [...] │ │
│ │ 程序文件汇编   │ 李四   │ 王五      │ 审核中│ 2026-02  │ [...] │ │
│ │ 作业指导书     │ 王五   │ -         │ 已通过│ 2026-01  │ [...] │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 80 条  [1][2][3]...[8]  10条/页 ▼                            │
└─────────────────────────────────────────────────────────────────┘
```

#### 标签页切换

**标签** (从左到右):
1. `[我发起的]` - 我发起的审批
2. `[待我审批]` - 需要我审批的
3. `[我已审批]` - 我已审批的
4. `[全部]` - 全部审批记录 (仅管理员可见)

#### 操作列按钮

**列宽**: 140px  
**顺序** (从左到右):
1. `[审批]` - 链接按钮 (主色)
2. `[详情]` - 链接按钮
3. `[撤回]` - 链接按钮 (危险色)

**按钮状态映射**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 审批 | 状态=审核中 且 当前审批人=当前用户 | 其他情况 |
| 详情 | 始终启用 | - |
| 撤回 | 状态=审核中 且 发起人=当前用户 | 状态≠审核中 或 发起人≠当前用户 |

---

### 4.2 审批操作对话框

#### 页面布局

```
┌─────────────────────────────────────────────────┐
│ 审批 - 质量手册V2.0                     [×]      │ ← 80%宽×80%高
├─────────────────────────────────────────────────┤
│ 审批流程:                                        │
│ [张三] > [李四 (当前)] > [王五]                 │
│        (已通过)  (审核中)   (待审核)             │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 文档信息                                     │ │
│ │ • 文档名称: 质量手册V2.0                     │ │
│ │ • 文档编号: DOC-001                          │ │
│ │ • 所属部门: 质量部                           │ │
│ │ • 发起人: 张三                               │ │
│ │ • 发起时间: 2026-02-10 10:30                 │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 审批历史                                     │ │
│ │ ┌───────────────────────────────────────┐   │ │
│ │ │ 审批人│ 操作  │ 意见      │ 审批时间   │   │ │
│ │ ├───────────────────────────────────────┤   │ │
│ │ │ 张三  │ 发起  │ -         │ 2026-02-10 │   │ │
│ │ └───────────────────────────────────────┘   │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 审批意见                                     │ │
│ │ [_______________________________________]   │ │
│ │ [_______________________________________]   │ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                          [驳回] [通过]          │
└─────────────────────────────────────────────────┘
```

#### 审批流程显示

**显示方式**: 标签链 + 状态标识

```html
<div class="approval-flow">
  <el-tag type="success">张三 (已通过)</el-tag>
  <span class="arrow">></span>
  <el-tag type="warning">李四 (审核中)</el-tag>
  <span class="arrow">></span>
  <el-tag type="info">王五 (待审核)</el-tag>
</div>
```

#### 按钮说明

**底部按钮** (从左到右):
1. `[驳回]` - 危险按钮 (type="danger")
   - 必须填写驳回意见
   - 驳回后文档状态改为"已驳回"
   - 审批流程结束
   
2. `[通过]` - 主按钮 (type="primary")
   - 审批意见选填
   - 通过后流程流转到下一审批人
   - 如果是最后一个审批人，文档状态改为"已发布"

#### 交互流程

**流程 1: 审批通过**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 填写审批意见 (选填) | -
2    | 点击"通过" | 弹出确认对话框 "确定通过该文档审批？"
3    | 点击"确定" | 保存审批记录 → 流转到下一审批人 (或结束流程) → 关闭对话框 → 刷新列表 → 绿色 Toast "审批通过"
```

**流程 2: 审批驳回**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 填写驳回意见 | 实时验证 (必填)
2    | 点击"驳回" | 验证驳回意见 → 未填写: 红色 Toast "请填写驳回意见" → 已填写: 弹出确认对话框 "确定驳回该文档审批？驳回后流程将结束"
3    | 点击"确定" | 保存审批记录 → 文档状态改为"已驳回" → 结束流程 → 关闭对话框 → 刷新列表 → 绿色 Toast "已驳回"
```

---

## 模块 5: 权限管理

### 5.1 用户管理列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 用户管理                                    [+ 新建用户] [导出]  │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 角色: [全部▼] 部门: [全部▼] [搜索][重置] │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 用户名 │ 姓名 │ 角色   │ 部门     │ 状态  │ 最后登录 │ 操作│ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ admin │ 管理员│ 管理员 │ 管理部   │ 正常  │ 2026-02  │ [...] │ │
│ │ zhangsan│ 张三│ 普通用户│ 质量部  │ 正常  │ 2026-02  │ [...] │ │
│ │ lisi  │ 李四  │ 部门主管│ 生产部  │ 禁用  │ 2026-01  │ [...] │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 30 条  [1][2][3]  10条/页 ▼                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 用户状态

**状态类型**:
- `正常` - 绿色 (success)
- `禁用` - 灰色 (info)
- `锁定` - 红色 (danger)

#### 操作列按钮

**列宽**: 180px  
**顺序** (从左到右):
1. `[编辑]` - 链接按钮
2. `[重置密码]` - 链接按钮
3. `[禁用]` / `[启用]` - 链接按钮
4. `[删除]` - 链接按钮 (危险色)

**按钮状态映射**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 编辑 | 当前用户=管理员 | 当前用户≠管理员 |
| 重置密码 | 当前用户=管理员 | 当前用户≠管理员 |
| 禁用/启用 | 当前用户=管理员 且 目标用户≠当前用户 | 目标用户=当前用户 |
| 删除 | 当前用户=管理员 且 目标用户≠当前用户 且 目标用户无关联数据 | 其他情况 |

---

### 5.2 角色管理列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 角色管理                                    [+ 新建角色]         │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 角色名称   │ 角色编码 │ 用户数 │ 创建时间   │ 操作      │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 管理员     │ admin    │ 1      │ 2026-01-01 │ [权限][编辑][删除] │ │
│ │ 部门主管   │ manager  │ 5      │ 2026-01-01 │ [权限][编辑][删除] │ │
│ │ 普通用户   │ user     │ 20     │ 2026-01-01 │ [权限][编辑][删除] │ │
│ └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 操作列按钮

**列宽**: 160px  
**顺序** (从左到右):
1. `[权限]` - 链接按钮 (主色)
2. `[编辑]` - 链接按钮
3. `[删除]` - 链接按钮 (危险色)

---

### 5.3 权限配置对话框

#### 页面布局

```
┌─────────────────────────────────────────────────┐
│ 权限配置 - 普通用户                     [×]      │ ← 70%宽×80%高
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 功能权限                                     │ │
│ │ ┌─────────────────────────────────────────┐ │ │
│ │ │ ☑ 文档管理                              │ │ │
│ │ │   ☑ 查看文档                            │ │ │
│ │ │   ☑ 新建文档                            │ │ │
│ │ │   ☐ 编辑文档                            │ │ │
│ │ │   ☐ 删除文档                            │ │ │
│ │ │ ☑ 模板管理                              │ │ │
│ │ │   ☑ 查看模板                            │ │ │
│ │ │   ☐ 新建模板                            │ │ │
│ │ │   ☐ 编辑模板                            │ │ │
│ │ │   ☐ 删除模板                            │ │ │
│ │ │ ☑ 任务管理                              │ │ │
│ │ │   ☑ 查看任务                            │ │ │
│ │ │   ☑ 填报任务                            │ │ │
│ │ │   ☐ 新建任务                            │ │ │
│ │ │   ☐ 删除任务                            │ │ │
│ │ └─────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                          [取消] [保存]          │
└─────────────────────────────────────────────────┘
```

#### 权限树结构

**权限分组**:
1. **文档管理**
   - 查看文档
   - 新建文档
   - 编辑文档
   - 删除文档
   - 导出文档

2. **模板管理**
   - 查看模板
   - 新建模板
   - 编辑模板
   - 删除模板
   - 字段管理

3. **任务管理**
   - 查看任务
   - 新建任务
   - 填报任务
   - 删除任务

4. **审批管理**
   - 查看审批
   - 发起审批
   - 审批文档

5. **系统管理**
   - 用户管理
   - 角色管理
   - 权限管理
   - 部门管理
   - 系统设置

---

## 模块 6: 回收站

### 6.1 回收站列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 回收站                            [批量恢复] [批量彻底删除]     │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 搜索: [___________] 类型: [全部▼] [搜索][重置]               │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ☐│文档名称      │类型│删除人│删除时间    │剩余天数│操作   │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ ☐│质量手册V2.0  │文档│张三  │2026-02-01  │28天    │[恢复][删除]│ │
│ │ ☐│生产记录表    │模板│李四  │2026-02-05  │24天    │[恢复][删除]│ │
│ │ ☐│1月生产任务   │任务│王五  │2026-02-10  │19天    │[恢复][删除]│ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 15 条  [1][2]  10条/页 ▼                                     │
└─────────────────────────────────────────────────────────────────┘
```

#### 剩余天数显示

**颜色规则**:
- `>7天` - 绿色
- `4-7天` - 橙色
- `≤3天` - 红色

#### 操作列按钮

**列宽**: 140px  
**顺序** (从左到右):
1. `[恢复]` - 链接按钮 (主色)
2. `[彻底删除]` - 链接按钮 (危险色)

**按钮状态映射**:

| 按钮 | 启用条件 | 禁用条件 |
|------|----------|----------|
| 恢复 | 当前用户=删除人 或 管理员 | 其他用户 |
| 彻底删除 | 当前用户=删除人 或 管理员 | 其他用户 |

#### 交互流程

**流程 1: 恢复**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"恢复" | 弹出确认对话框 "确定恢复该文档？"
2    | 点击"确定" | 恢复数据 → 从回收站移除 → 刷新列表 → 绿色 Toast "恢复成功"
```

**流程 2: 彻底删除**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"彻底删除" | 弹出确认对话框 "确定永久删除该文档？此操作不可恢复"
2    | 点击"确定" | 永久删除数据 → 刷新列表 → 绿色 Toast "已永久删除"
```

**流程 3: 批量操作**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 勾选多个项 | 顶部按钮启用
2    | 点击"批量恢复" / "批量彻底删除" | 弹出确认对话框 "确定恢复/删除选中的 5 个项目？"
3    | 点击"确定" | 批量操作 → 刷新列表 → 绿色 Toast "批量操作成功"
```

---

## 模块 7: 通知系统

### 7.1 通知列表页

#### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 通知中心                  [全部标为已读] [清空已读]             │
├─────────────────────────────────────────────────────────────────┤
│ [全部] [未读] [已读]                                             │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 🔴 您有1个新的审批任务                    2026-02-13 10:30  │ │
│ │    文档《质量手册V2.0》需要您审批              [立即查看]   │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 🔴 任务即将到期提醒                      2026-02-13 09:00  │ │
│ │    任务《2月生产记录填报》将于今天截止         [查看详情]   │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ ⚪ 您提交的文档已通过审批                  2026-02-12 15:30  │ │
│ │    文档《程序文件汇编》审批通过                [查看详情]   │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 共 50 条  [1][2][3]...[5]  10条/页 ▼                            │
└─────────────────────────────────────────────────────────────────┘
```

#### 通知类型

**通知分类**:
- **审批通知**: 新的审批任务、审批结果
- **任务通知**: 任务分配、任务到期提醒
- **系统通知**: 回收站清理提醒、密码到期提醒

#### 未读标识

- `🔴` 红色圆点 - 未读
- `⚪` 白色圆点 - 已读

#### 交互流程

**流程 1: 查看通知**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击通知项 | 标记为已读 → 跳转到对应页面 (如审批详情、任务详情)
```

**流程 2: 全部标为已读**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"全部标为已读" | 将所有未读通知标记为已读 → 刷新列表 → 绿色 Toast "已全部标为已读"
```

**流程 3: 清空已读**

```
步骤 | 用户操作 | 系统响应
-----|----------|----------
1    | 点击"清空已读" | 弹出确认对话框 "确定清空所有已读通知？"
2    | 点击"确定" | 删除所有已读通知 → 刷新列表 → 绿色 Toast "已清空"
```

---

## 附录 1: 组件库规范

### Element Plus 组件使用规范

#### 按钮 (el-button)

**类型 (type)**:
- `primary` - 主按钮 (蓝色) - 用于主要操作
- `success` - 成功按钮 (绿色) - 用于确认操作
- `warning` - 警告按钮 (橙色) - 用于警告操作
- `danger` - 危险按钮 (红色) - 用于删除/危险操作
- `info` - 信息按钮 (灰色) - 用于次要操作
- `default` - 默认按钮 (白色) - 用于普通操作

**样式 (link/plain/text)**:
- `link` - 链接样式按钮 - 用于表格操作列
- `plain` - 朴素按钮 - 用于次要操作
- `text` - 文字按钮 - 用于辅助操作

**尺寸 (size)**:
- `large` - 大按钮 - 用于页面主操作
- `default` - 默认按钮 - 用于一般操作
- `small` - 小按钮 - 用于表格操作

#### 对话框 (el-dialog)

**标准尺寸**:
```vue
<!-- 编辑对话框 -->
<el-dialog width="80%" :style="{ height: '80vh' }">

<!-- 详情对话框 -->
<el-dialog width="70%" :style="{ height: '80vh' }">

<!-- 选择对话框 -->
<el-dialog width="60%" :style="{ height: '70vh' }">

<!-- 预览对话框 -->
<el-dialog width="90%" :style="{ height: '90vh' }">
```

#### 消息提示 (ElMessage)

**类型**:
```typescript
// 成功提示 (2秒自动关闭)
ElMessage.success('操作成功')

// 失败提示 (3秒自动关闭)
ElMessage.error('操作失败：' + error.message)

// 警告提示 (3秒自动关闭)
ElMessage.warning('请先选择数据')

// 信息提示 (2秒自动关闭)
ElMessage.info('正在处理中...')
```

#### 确认框 (ElMessageBox)

**删除确认**:
```typescript
await ElMessageBox.confirm(
  '确定删除该文档？删除后可在回收站恢复',
  '删除确认',
  {
    confirmButtonText: '确定',
    cancelButtonText: '取消',
    type: 'warning'
  }
)
```

**危险操作确认**:
```typescript
await ElMessageBox.confirm(
  '确定永久删除该文档？此操作不可恢复',
  '警告',
  {
    confirmButtonText: '确定删除',
    cancelButtonText: '取消',
    type: 'error'
  }
)
```

#### 表格 (el-table)

**标准配置**:
```vue
<el-table
  :data="tableData"
  stripe          <!-- 斑马纹 -->
  border          <!-- 边框 -->
  v-loading="loading"  <!-- 加载状态 -->
  @selection-change="handleSelectionChange"  <!-- 多选 -->
>
  <el-table-column type="selection" width="55" />  <!-- 多选列 -->
  <el-table-column prop="name" label="名称" min-width="200" />
  <el-table-column label="操作" width="160" fixed="right" />
</el-table>
```

#### 表单 (el-form)

**验证配置**:
```vue
<el-form
  ref="formRef"
  :model="formData"
  :rules="rules"
  label-width="120px"
>
  <el-form-item label="文档名称" prop="name">
    <el-input
      v-model="formData.name"
      placeholder="请输入文档名称"
      maxlength="200"
      show-word-limit
    />
  </el-form-item>
</el-form>
```

---

## 附录 2: UI 状态管理规范

### 加载状态 (Loading)

#### 全局加载

**使用场景**: 页面初始加载、大数据量请求

```vue
<script setup lang="ts">
import { ElLoading } from 'element-plus'

const fetchData = async () => {
  const loading = ElLoading.service({
    lock: true,
    text: '加载中...',
    background: 'rgba(0, 0, 0, 0.7)'
  })

  try {
    await api.getData()
  } finally {
    loading.close()
  }
}
</script>
```

#### 局部加载

**使用场景**: 表格加载、对话框内数据加载

```vue
<el-table v-loading="loading" :data="tableData">
  <!-- 表格列 -->
</el-table>
```

#### 骨架屏 (Skeleton)

**使用场景**: 首屏加载优化，提升感知性能

```vue
<template>
  <el-skeleton v-if="loading" :rows="5" animated />
  <div v-else>
    <!-- 实际内容 -->
  </div>
</template>
```

**骨架屏模板**:
```vue
<el-skeleton :rows="5" animated>
  <template #template>
    <el-skeleton-item variant="h1" style="width: 50%" />
    <el-skeleton-item variant="text" style="margin-top: 16px" />
    <el-skeleton-item variant="text" style="width: 60%" />
  </template>
</el-skeleton>
```

### 错误状态 (Error)

#### API 错误提示

**网络错误**:
```typescript
try {
  await api.createDocument(data)
  ElMessage.success('创建成功')
} catch (error) {
  if (error.response?.status === 401) {
    ElMessage.error('登录已过期，请重新登录')
    router.push('/login')
  } else if (error.response?.status === 403) {
    ElMessage.error('无权限执行此操作')
  } else if (error.response?.status === 500) {
    ElMessage.error('服务器错误，请稍后重试')
  } else {
    ElMessage.error(error.message || '操作失败')
  }
}
```

#### 表单验证错误

**字段级错误**:
```vue
<el-form-item label="文档名称" prop="name" :error="errors.name">
  <el-input v-model="formData.name" />
</el-form-item>
```

**表单提交错误**:
```typescript
const submitForm = async () => {
  try {
    await formRef.value?.validate()
    await api.submitForm(formData)
  } catch (error) {
    if (error.fields) {
      // 表单验证失败
      ElMessage.warning('请检查表单填写')
    } else {
      // 提交失败
      ElMessage.error('提交失败: ' + error.message)
    }
  }
}
```

#### 空状态 (Empty)

**列表为空**:
```vue
<template>
  <el-table v-if="tableData.length > 0" :data="tableData">
    <!-- 表格列 -->
  </el-table>

  <el-empty v-else description="暂无数据">
    <el-button type="primary" @click="handleCreate">
      创建第一条记录
    </el-button>
  </el-empty>
</template>
```

**搜索无结果**:
```vue
<el-empty
  description="未找到匹配的结果"
  :image-size="120"
>
  <el-button @click="resetSearch">清空搜索条件</el-button>
</el-empty>
```

### 提交状态

**按钮加载状态**:
```vue
<el-button
  type="primary"
  :loading="submitting"
  :disabled="submitting"
  @click="handleSubmit"
>
  {{ submitting ? '提交中...' : '提交' }}
</el-button>
```

**表单禁用状态**:
```vue
<el-form :disabled="submitting">
  <!-- 表单字段 -->
</el-form>
```

---

## 附录 3: 快捷键支持

### 全局快捷键

| 快捷键 | 功能 | 作用范围 |
|--------|------|---------|
| `Ctrl + S` / `⌘ + S` | 保存 | 编辑对话框、表单页 |
| `Esc` | 关闭对话框 | 所有对话框 |
| `Ctrl + F` / `⌘ + F` | 聚焦搜索框 | 列表页 |
| `Ctrl + Enter` / `⌘ + Enter` | 提交表单 | 编辑对话框、表单页 |
| `Alt + N` | 新建记录 | 列表页 |
| `Alt + R` | 刷新列表 | 列表页 |

### 表格快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `↑` / `↓` | 上下选择行 | 表格焦点时 |
| `Enter` | 编辑当前行 | 表格焦点时 |
| `Delete` | 删除当前行 | 表格焦点时（需确认） |
| `Ctrl + A` / `⌘ + A` | 全选 | 表格焦点时 |
| `Space` | 勾选当前行 | 表格焦点时 |

### 对话框快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Tab` | 下一个字段 | 表单内导航 |
| `Shift + Tab` | 上一个字段 | 表单内导航 |
| `Enter` | 确定 | 焦点在确定按钮时 |
| `Esc` | 取消/关闭 | 任意时候 |

### 实现示例

**全局快捷键监听**:
```typescript
// composables/useShortcuts.ts
import { onMounted, onUnmounted } from 'vue'

export function useShortcuts(shortcuts: Record<string, () => void>) {
  const handleKeydown = (e: KeyboardEvent) => {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0
    const ctrlKey = isMac ? e.metaKey : e.ctrlKey

    // Ctrl/⌘ + S: 保存
    if (ctrlKey && e.key === 's') {
      e.preventDefault()
      shortcuts.save?.()
    }

    // Esc: 关闭
    if (e.key === 'Escape') {
      shortcuts.close?.()
    }

    // Ctrl/⌘ + Enter: 提交
    if (ctrlKey && e.key === 'Enter') {
      e.preventDefault()
      shortcuts.submit?.()
    }
  }

  onMounted(() => {
    document.addEventListener('keydown', handleKeydown)
  })

  onUnmounted(() => {
    document.removeEventListener('keydown', handleKeydown)
  })
}
```

**使用方式**:
```vue
<script setup lang="ts">
import { useShortcuts } from '@/composables/useShortcuts'

useShortcuts({
  save: handleSave,
  close: handleClose,
  submit: handleSubmit
})
</script>
```

---

## 附录 4: 动画与过渡效果

### 页面切换动画

**路由切换动画**:
```vue
<template>
  <router-view v-slot="{ Component }">
    <transition name="fade" mode="out-in">
      <component :is="Component" />
    </transition>
  </router-view>
</template>

<style scoped>
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
</style>
```

### 列表项动画

**列表插入/删除动画**:
```vue
<template>
  <transition-group name="list" tag="div">
    <div v-for="item in items" :key="item.id" class="list-item">
      {{ item.name }}
    </div>
  </transition-group>
</template>

<style scoped>
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.3s ease;
}

.list-enter-from {
  opacity: 0;
  transform: translateY(-30px);
}

.list-leave-to {
  opacity: 0;
  transform: translateY(30px);
}

.list-leave-active {
  position: absolute;
}
</style>
```

### 对话框动画

**对话框打开/关闭动画**:
```vue
<el-dialog
  v-model="dialogVisible"
  :append-to-body="true"
  :close-on-click-modal="false"
>
  <template #default>
    <transition name="dialog-fade" mode="out-in">
      <div v-if="dialogVisible">
        <!-- 对话框内容 -->
      </div>
    </transition>
  </template>
</el-dialog>

<style scoped>
.dialog-fade-enter-active,
.dialog-fade-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.dialog-fade-enter-from {
  opacity: 0;
  transform: scale(0.95);
}

.dialog-fade-leave-to {
  opacity: 0;
  transform: scale(0.95);
}
</style>
```

### 加载动画

**自定义加载动画**:
```vue
<template>
  <div v-if="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>加载中...</p>
  </div>
</template>

<style scoped>
.loading-spinner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-left-color: #409EFF;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
</style>
```

### 提示消息动画

**Toast 弹出动画**（Element Plus 自带）:
```typescript
ElMessage({
  message: '操作成功',
  type: 'success',
  duration: 2000,
  showClose: true,
  offset: 60  // 从顶部偏移量
})
```

---

## 附录 5: 可访问性（Accessibility）规范

### ARIA 属性使用

#### 按钮角色

```vue
<button
  role="button"
  :aria-label="isOpen ? '关闭菜单' : '打开菜单'"
  :aria-expanded="isOpen"
  @click="toggleMenu"
>
  <span class="icon" aria-hidden="true">☰</span>
</button>
```

#### 对话框角色

```vue
<div
  role="dialog"
  aria-modal="true"
  :aria-labelledby="dialogTitleId"
  :aria-describedby="dialogDescId"
>
  <h2 :id="dialogTitleId">对话框标题</h2>
  <p :id="dialogDescId">对话框描述</p>
</div>
```

#### 表单标签

```vue
<label for="document-name">文档名称</label>
<input
  id="document-name"
  v-model="formData.name"
  aria-required="true"
  :aria-invalid="!!errors.name"
  :aria-describedby="errors.name ? 'name-error' : undefined"
/>
<span v-if="errors.name" id="name-error" role="alert">
  {{ errors.name }}
</span>
```

### 键盘导航支持

#### 表格键盘导航

```vue
<template>
  <table
    role="grid"
    aria-label="文档列表"
    @keydown="handleTableKeydown"
  >
    <tbody>
      <tr
        v-for="(row, index) in tableData"
        :key="row.id"
        :tabindex="index === activeRow ? 0 : -1"
        :aria-selected="index === activeRow"
        role="row"
      >
        <td role="gridcell">{{ row.name }}</td>
      </tr>
    </tbody>
  </table>
</template>

<script setup lang="ts">
const activeRow = ref(0)

const handleTableKeydown = (e: KeyboardEvent) => {
  if (e.key === 'ArrowDown') {
    e.preventDefault()
    activeRow.value = Math.min(activeRow.value + 1, tableData.length - 1)
  } else if (e.key === 'ArrowUp') {
    e.preventDefault()
    activeRow.value = Math.max(activeRow.value - 1, 0)
  } else if (e.key === 'Enter') {
    handleEdit(tableData[activeRow.value])
  }
}
</script>
```

#### 对话框焦点管理

```vue
<script setup lang="ts">
import { nextTick, ref, watch } from 'vue'

const dialogVisible = ref(false)
const firstFocusableElement = ref<HTMLElement>()
const lastFocusableElement = ref<HTMLElement>()

watch(dialogVisible, async (visible) => {
  if (visible) {
    await nextTick()
    // 自动聚焦第一个可聚焦元素
    firstFocusableElement.value?.focus()
  }
})

const handleDialogKeydown = (e: KeyboardEvent) => {
  if (e.key === 'Tab') {
    const focusableElements = Array.from(
      document.querySelectorAll('button, input, select, textarea, [tabindex]:not([tabindex="-1"])')
    ) as HTMLElement[]

    const firstElement = focusableElements[0]
    const lastElement = focusableElements[focusableElements.length - 1]

    if (e.shiftKey && document.activeElement === firstElement) {
      e.preventDefault()
      lastElement.focus()
    } else if (!e.shiftKey && document.activeElement === lastElement) {
      e.preventDefault()
      firstElement.focus()
    }
  }
}
</script>
```

### 屏幕阅读器支持

#### 实时更新通知

```vue
<div
  role="status"
  aria-live="polite"
  aria-atomic="true"
  class="sr-only"
>
  {{ statusMessage }}
</div>

<style>
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
</style>
```

#### 错误通知

```vue
<div
  v-if="error"
  role="alert"
  aria-live="assertive"
  class="error-message"
>
  {{ error }}
</div>
```

### 色盲友好设计

#### 状态不仅依赖颜色

```vue
<!-- ❌ 不好：仅用颜色区分 -->
<span class="status success">成功</span>

<!-- ✅ 好：颜色 + 图标 + 文字 -->
<el-tag type="success">
  <el-icon><Check /></el-icon>
  成功
</el-tag>
```

#### 对比度要求

```css
/* WCAG AA 标准：文本对比度至少 4.5:1 */
.text-on-light {
  color: #333333;  /* 对比度 12.6:1 ✅ */
  background: #ffffff;
}

.text-on-dark {
  color: #ffffff;  /* 对比度 21:1 ✅ */
  background: #000000;
}

/* 大文本（18px+）对比度至少 3:1 */
.large-text {
  font-size: 18px;
  color: #666666;  /* 对比度 5.7:1 ✅ */
  background: #ffffff;
}
```

---

## 附录 6: 异常处理规范

### 网络异常

**请求超时**:
```typescript
import axios from 'axios'

const request = axios.create({
  timeout: 10000  // 10秒超时
})

request.interceptors.response.use(
  response => response,
  error => {
    if (error.code === 'ECONNABORTED') {
      ElMessage.error('请求超时，请检查网络连接')
    } else if (!error.response) {
      ElMessage.error('网络连接失败，请稍后重试')
    }
    return Promise.reject(error)
  }
)
```

**请求重试**:
```typescript
async function fetchWithRetry(url: string, maxRetries = 3) {
  let lastError: Error

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await request.get(url)
    } catch (error) {
      lastError = error as Error
      if (i < maxRetries - 1) {
        await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)))
      }
    }
  }

  throw lastError!
}
```

### 表单验证异常

**自定义验证器**:
```typescript
const validateDocumentName = (rule: any, value: string, callback: Function) => {
  if (!value) {
    callback(new Error('请输入文档名称'))
  } else if (value.length > 200) {
    callback(new Error('文档名称不能超过200字符'))
  } else if (!/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/.test(value)) {
    callback(new Error('文档名称只能包含中英文、数字、下划线和横线'))
  } else {
    callback()
  }
}

const rules = {
  name: [
    { required: true, message: '请输入文档名称', trigger: 'blur' },
    { validator: validateDocumentName, trigger: 'blur' }
  ]
}
```

### 权限不足处理

**403 权限拦截**:
```typescript
request.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 403) {
      ElMessage.error('无权限执行此操作')
      // 可选：跳转到权限申请页
      // router.push('/request-permission')
    }
    return Promise.reject(error)
  }
)
```

**前端按钮权限控制**:
```vue
<template>
  <el-button
    v-if="hasPermission('DOCUMENT_DELETE')"
    type="danger"
    @click="handleDelete"
  >
    删除
  </el-button>
</template>

<script setup lang="ts">
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

const hasPermission = (permission: string) => {
  return userStore.permissions.includes(permission)
}
</script>
```

### 数据冲突处理

**乐观锁冲突**:
```typescript
try {
  await api.updateDocument({
    id: document.id,
    version: document.version,  // 版本号
    ...updates
  })
  ElMessage.success('保存成功')
} catch (error) {
  if (error.response?.status === 409) {
    ElMessageBox.confirm(
      '该文档已被其他用户修改，是否重新加载最新版本？',
      '数据冲突',
      {
        confirmButtonText: '重新加载',
        cancelButtonText: '取消',
        type: 'warning'
      }
    ).then(() => {
      location.reload()  // 重新加载页面
    })
  }
}
```

**并发提交冲突**:
```typescript
const isSubmitting = ref(false)

const handleSubmit = async () => {
  if (isSubmitting.value) {
    ElMessage.warning('操作进行中，请稍候...')
    return
  }

  isSubmitting.value = true
  try {
    await api.submitForm(formData)
    ElMessage.success('提交成功')
  } finally {
    isSubmitting.value = false
  }
}
```

---

## 附录 7: 响应式设计规范

### 断点定义

| 断点 | 设备类型 | 最小宽度 | 容器宽度 | MVP 支持 |
|------|---------|---------|---------|---------|
| `xs` | 手机 | < 768px | 100% | ❌ 不支持 |
| `sm` | 平板（竖屏） | ≥ 768px | 750px | ❌ 不支持 |
| `md` | 平板（横屏） | ≥ 992px | 970px | ❌ 不支持 |
| `lg` | 桌面 | ≥ 1200px | 1170px | ✅ **主要支持** |
| `xl` | 大屏桌面 | ≥ 1920px | 1200px | ✅ **主要支持** |

**说明**: MVP 阶段仅支持桌面端（≥ 1200px），移动端适配在后续版本实现。

### 桌面端布局规范

**最小支持分辨率**: 1366 × 768（主流桌面）

**布局结构**:
```
┌──────────────────────────────────────────┐
│ Header (固定高度 60px)                    │
├──────┬───────────────────────────────────┤
│      │                                   │
│ 侧边栏│         主内容区                  │
│ 200px│      (自适应宽度)                 │
│      │                                   │
│      │                                   │
└──────┴───────────────────────────────────┘
```

**容器最大宽度**:
```css
.main-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}
```

### 表格响应式处理

**固定操作列**:
```vue
<el-table>
  <el-table-column prop="name" label="名称" min-width="200" />
  <el-table-column prop="status" label="状态" width="100" />
  <el-table-column label="操作" width="160" fixed="right" />
</el-table>
```

**表格滚动**:
```vue
<el-table
  :max-height="600"
  :scroll-x="true"
>
  <!-- 表格列 -->
</el-table>
```

### 表单响应式布局

**2列布局（桌面）**:
```vue
<el-form label-width="120px">
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="文档名称" prop="name">
        <el-input v-model="formData.name" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="文档编号" prop="code">
        <el-input v-model="formData.code" />
      </el-form-item>
    </el-col>
  </el-row>
</el-form>
```

**全宽字段（描述性内容）**:
```vue
<el-form-item label="文档描述" prop="description">
  <el-input
    v-model="formData.description"
    type="textarea"
    :rows="4"
  />
</el-form-item>
```

---

## 总结

本文档详细定义了文档管理系统的前端交互规范，包括：

1. **全局设计规范** - 颜色、间距、字体、对话框尺寸
2. **7个核心模块** - 文档、模板、任务、审批、权限、回收站、通知
3. **完整交互流程** - 每个操作的用户步骤和系统响应
4. **按钮状态映射** - 每个按钮的启用/禁用条件
5. **组件使用规范** - Element Plus 组件的标准用法
6. **UI 状态管理** - Loading、Error、Empty、Skeleton 状态处理
7. **快捷键支持** - 全局快捷键、表格快捷键、对话框快捷键
8. **动画与过渡** - 页面切换、列表项、对话框、加载动画
9. **可访问性规范** - ARIA 属性、键盘导航、屏幕阅读器、色盲友好
10. **异常处理** - 网络异常、表单验证、权限不足、数据冲突
11. **响应式设计** - 断点定义、桌面端布局、表格/表单响应式处理

开发时请严格按照本规范执行，确保用户体验的一致性和完整性。

