# 移动端应用（Layer 3 移动端）

> **来源**: DESIGN.md 第二十章（移动端应用设计）  
> **文档版本**: 1.0  
> **最后更新**: 2026-02-14  
> **实现状态**: ⏳ 未实现（PRD + LLD 已完成）  
> **优先级**: ⭐⭐⭐ 最高（Phase A 基础设施）  
> **依赖**: 动态表单引擎、TodoTask 统一待办

---

## 目录

- [1. 系统定位](#1-系统定位)
- [2. 核心功能](#2-核心功能)
- [3. 技术架构](#3-技术架构)

---

## 1. 系统定位

**移动端应用**（uniapp 跨平台）是现场人员的主要工作界面，支持微信小程序 + H5 + APP 三端统一。

### 1.1 核心优势

| 优势 | 说明 |
|------|------|
| **一套代码三端运行** | 编译为微信小程序、H5、APP（iOS/Android） |
| **离线填写** | 本地存储数据，联网后自动同步 |
| **现场拍照** | 调用相机拍照上传（维保、巡检、清洁等） |
| **电子签名** | 手写签字板签名（符合 BRCGS 要求） |
| **微信推送** | 订阅消息推送待办提醒、临期预警等 |
| **扫码功能** | 扫描设备二维码、物料条形码（v2.0） |

### 1.2 核心职责

1. **首页 + 待办列表**: 显示待办任务、快捷入口
2. **动态表单渲染**: 支持 20+ 字段类型（移动端适配）
3. **现场拍照上传**: 调用相机拍照、图片压缩、上传 MinIO
4. **电子签名**: 手写签字板组件、签名图片上传
5. **离线填写**: 本地存储、同步队列、自动同步
6. **日历视图**: 维护计划日历、培训计划日历
7. **记录查询**: 查询历史记录、筛选、预览
8. **微信推送**: 订阅消息推送、模板消息

---

## 2. 核心功能

### 2.1 首页 + 待办列表

**首页布局**:
- 顶部：用户信息、通知铃铛
- 快捷入口：常用功能卡片（待办、记录、日历、设备）
- 待办列表：显示待办任务（支持筛选：全部/培训/审批/设备）

**待办列表**:
- 支持按类型筛选（training_attend、approval、equipment_maintain、audit_rectification）
- 显示待办标题、截止时间、优先级
- 点击跳转到详情页

### 2.2 动态表单渲染

**支持的字段类型**（移动端适配）:
- text, number, textarea, date, time, datetime
- select, multiselect, radio, checkbox
- image（拍照上传）, signature（电子签名）
- scan（扫码输入，v2.0）

**移动端特性**:
- 表单布局：单列布局（适配小屏）
- 实时校验：输入时校验，显示错误提示
- 自动保存草稿：每 30 秒自动保存到本地

### 2.3 现场拍照上传

**功能**:
- 调用相机拍照或选择相册图片
- 自动压缩图片（最大 800px 宽度，质量 80%）
- 上传到 MinIO（支持批量上传）
- 生成缩略图（200x200）

### 2.4 电子签名

**功能**:
- 手写签字板组件（canvas 实现）
- 签名预览确认
- 重新签名功能
- 签名图片上传到 MinIO

### 2.5 离线填写

**功能**:
- 离线填写记录：数据保存到本地存储（uni.setStorageSync）
- 同步队列：记录未同步的数据
- 自动同步：联网后自动上传到服务器
- 同步失败重试：最多重试 3 次

### 2.6 微信推送

**支持的推送类型**:
- 待办提醒：培训待办、设备维保待办、审批待办
- 临期预警：物料批次即将过期
- 审批通知：记录审批结果通知

---

## 3. 技术架构

### 3.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| uniapp | 最新版 | 跨平台开发框架 |
| Vue 3 | 最新版 | 前端框架 |
| uni-ui | 最新版 | UI 组件库 |
| Pinia | 最新版 | 状态管理 |
| TypeScript | 最新版 | 类型安全 |

### 3.2 目录结构

```
mobile/
├── pages/                  # 页面
│   ├── index/             # 首页
│   ├── todo/              # 待办列表
│   ├── records/           # 记录查询
│   ├── calendar/          # 日历视图
│   └── equipment/         # 设备管理
├── components/            # 组件
│   ├── DynamicForm.vue   # 动态表单
│   ├── Signature.vue     # 电子签名
│   └── Camera.vue        # 拍照组件
├── stores/                # Pinia 状态管理
│   ├── user.ts           # 用户状态
│   ├── todo.ts           # 待办状态
│   └── offline.ts        # 离线状态
├── utils/                 # 工具函数
│   ├── request.ts        # 网络请求
│   ├── storage.ts        # 本地存储
│   └── image.ts          # 图片压缩
└── App.vue               # 应用入口
```

### 3.3 开发工作量估算

| 阶段 | 工作量 | 说明 |
|------|--------|------|
| **移动端开发** | 5 周 | 基础框架 + 动态表单 + 拍照签名 + 离线同步 + 微信推送 + E2E 测试 |
| **后端 API 调整** | 1 周 | 移动端文件上传优化 + 离线同步 API + 微信推送服务 |
| **联调测试** | 0.5 周 | 移动端 + 后端联调 |
| **小程序审核** | 1 周 | 微信小程序提审 + 发布 |

**总计**: 7.5 周（约 2 个月）  
**并行开发**（1 名移动端 + 1 名后端）: **约 5 周**

### 3.4 成功标准

**移动端基础功能**:
- ✅ 一套代码编译为微信小程序 + H5 + APP
- ✅ 首页 + 待办列表 + 记录查询

**移动端特有功能**:
- ✅ 现场拍照上传（调用相机）
- ✅ 电子签名（手写签字板）
- ✅ 离线填写（本地存储 + 自动同步）

**动态表单渲染**:
- ✅ 支持 20+ 字段类型（移动端适配）
- ✅ 实时校验、自动保存草稿

**微信生态集成**:
- ✅ 微信订阅消息推送
- ✅ 微信扫码（v2.0 条形码）

---

**本文档完成 ✅**
