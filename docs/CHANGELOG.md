# 变更日志

> 记录项目重要版本变更

---

## v10.6 (2026-02-13) - 文档完善版本 📚

### 重大更新

**DESIGN.md 完善**（v10.5 → v10.6）:
- ✅ 新增 MVP 实现状态追踪
  - Phase 1-6 完成度明细（98.1%，51/52 Issue）
  - 已实现功能清单（含代码位置）
  - 现有技术栈总结（Vue 3 + Element Plus + NestJS + Prisma）
  - 关键配置文件清单
- ✅ 新增增量开发指导
  - 新功能开发前检查清单（技术栈/数据模型/API/前端/测试）
  - 数据库迁移策略（Prisma Schema 更新步骤 + 向后兼容原则）
  - 前后端集成测试清单（后端 API 测试 + 前端集成测试 + E2E 测试）
  - 集成失败常见问题排查（API 404/401/403、Prisma 错误、前端白屏等）
  - 代码复用指南（推荐复用的现有组件/服务/工具）

**INTERACTION_DESIGN.md 完善**（v1.0 → v1.1）:
- ✅ 新增 UI 状态管理规范
  - Loading 状态（全局加载、局部加载、骨架屏）
  - Error 状态（API 错误提示、表单验证错误）
  - Empty 状态（列表为空、搜索无结果）
  - 提交状态（按钮加载、表单禁用）
- ✅ 新增快捷键支持
  - 全局快捷键（Ctrl+S 保存、Esc 关闭、Ctrl+F 搜索等）
  - 表格快捷键（↑↓ 选择、Enter 编辑、Delete 删除等）
  - 对话框快捷键（Tab 导航、Enter 确定、Esc 取消）
  - 实现示例（useShortcuts composable）
- ✅ 新增动画与过渡效果
  - 页面切换动画（fade、slide）
  - 列表项动画（插入/删除动画）
  - 对话框动画（打开/关闭动画）
  - 加载动画（自定义 spinner）
- ✅ 新增可访问性（Accessibility）规范
  - ARIA 属性使用（role、aria-label、aria-expanded 等）
  - 键盘导航支持（表格键盘导航、对话框焦点管理）
  - 屏幕阅读器支持（实时更新通知、错误通知）
  - 色盲友好设计（状态不仅依赖颜色、对比度要求）
- ✅ 新增异常处理规范
  - 网络异常（请求超时、请求重试）
  - 表单验证异常（自定义验证器）
  - 权限不足处理（403 拦截、按钮权限控制）
  - 数据冲突处理（乐观锁冲突、并发提交冲突）
- ✅ 新增响应式设计规范
  - 断点定义（xs/sm/md/lg/xl，MVP 主要支持 lg/xl）
  - 桌面端布局规范（最小分辨率 1366×768）
  - 表格响应式处理（固定操作列、表格滚动）
  - 表单响应式布局（2 列布局、全宽字段）

**文档更新**:
- ✅ README.md: v4.0 → v4.1（更新项目状态、文档说明）
- ✅ CHANGELOG.md: 新增 v10.6 版本记录

**更新动机**:
- 基于 MVP 已完成 98.1% 的事实，补充实现状态追踪
- 为后续增量开发提供明确的集成指导，避免破坏现有代码
- 完善前端交互设计的细节规范，覆盖所有 UI/UX 场景（Loading/Error/Empty、快捷键、动画、可访问性、异常处理、响应式）

**项目状态**:
- 🟢 设计阶段 100% 完成
- 🟢 业务规则 100% 完成（104 条）
- 🟢 前端交互规范 100% 完成（7 大模块 + 7 个附录）
- 🟢 MVP 实现状态追踪完成
- 🟢 增量开发指导完成
- ⏭️ 准备进入增量开发阶段

---

## v10.5 (2026-02-13) - 前端交互设计完成版本 🎨

### 重大更新

**前端交互设计规范完成**:
- ✅ 创建完整的交互设计文档（INTERACTION_DESIGN.md v1.0）
- ✅ 覆盖 7 大核心模块的完整交互规范
  - 文档管理（列表页 + 编辑对话框）
  - 模板管理（列表页 + 字段管理）
  - 任务管理（列表页 + 任务填报）
  - 审批流程（审批列表 + 审批操作）
  - 权限管理（用户管理 + 角色管理 + 权限配置）
  - 回收站（回收站列表 + 批量操作）
  - 通知系统（通知中心）

**交互设计内容**:
- ✅ 全局设计规范（颜色系统、间距系统、字体系统、对话框尺寸）
- ✅ 页面布局（ASCII 布局图，清晰直观）
- ✅ 按钮设计（位置、顺序、状态映射、样式规范）
- ✅ 交互流程（用户操作步骤 → 系统响应）
- ✅ 状态管理（数据状态、UI 状态）
- ✅ 用户体验细节（验证提示、反馈规范、快捷操作）
- ✅ Element Plus 组件使用规范

**业务规则补充**（BR-328 ~ BR-345，共 18 条）:
- ✅ BR-328 ~ BR-330: 审批流程可视化（标签链式展示、不能重复、动态配置）
- ✅ BR-334 ~ BR-336: 菜单权限动态显示（动态加载、隐藏无权限菜单、API 校验）
- ✅ BR-337 ~ BR-338: 表格操作列设计（状态动态控制、按钮样式规范）
- ✅ BR-339 ~ BR-340: 表单分组布局（分组区分字段、列数规范）
- ✅ BR-341 ~ BR-342: 状态标签可视化（彩色标签、颜色规范）
- ✅ BR-343: 对话框尺寸规范（编辑/详情/选择/预览/确认）
- ✅ BR-344 ~ BR-345: 操作反馈规范（Toast 类型、确认对话框规范）

**文档更新**:
- ✅ DESIGN.md: v10.4 → v10.5（新增 18 条业务规则）
- ✅ README.md: v3.1 → v4.0（新增交互设计文档引用）
- ✅ CHANGELOG.md: 新增 v10.5 版本记录

**技术参考**:
- 参考 SPMS-Web 优秀设计模式
- 符合 Material Design / Apple HIG 设计规范
- 使用 Vue 3 + Element Plus 技术栈

**项目状态**:
- 🟢 设计阶段 100% 完成
- 🟢 业务规则 100% 完成（104 条）
- 🟢 前端交互规范 100% 完成（7 大模块）
- ⏭️ 准备进入开发阶段

---

## v10.2 (2026-02-13) - 文档对齐与技术债务识别 📋

### 文档更新

**版本对齐**:
- ✅ 统一所有文档版本号（DESIGN.md 10.1 → README.md 3.1 → PROJECT_STRUCTURE.md 5.0 → CLAUDE.md 4.0）
- ✅ 同步项目状态描述
- ✅ 补充完整技术栈信息

**技术栈补充**:
- ✅ 前端: 明确 echarts 6.0+（数据可视化）、sortablejs 1.15+（拖拽排序）
- ✅ 后端: 明确 exceljs 4.4+（Excel导出）、@nestjs/swagger 7.1+（API文档）
- ✅ 后端: 明确 helmet 8.1+（安全）、minio 8.0+（对象存储客户端）

**项目状态明确**:
- ✅ MVP Phase 1-6: 完成 98.1%（51/52 Issue）
- ✅ Phase 7-12: 部分完成（Phase 7-9, 12 已实现）
- ✅ 技术债务: 已识别 3 个 P1 问题，待实施

### 技术债务

**已识别问题**（基于 DESIGN.md 第二十二章）:
- 📋 P1-1: Document 表归档/作废字段缺失（影响 BRCGS 合规）
- 📋 P1-2: Permission 和 UserPermission 表缺失（无法细粒度权限控制）
- 📋 P1-3: WorkflowTemplate/Instance/Task 表缺失（审批流程硬编码）

**实施原则**:
- ✅ 技术债务优先于新需求
- ✅ 功能依赖技术债务时，必须先修复债务再开发
- ✅ 每个迭代预留 20% 时间修复技术债务

**影响范围**:
- P1-1 影响 BRCGS 文档作废流程
- P1-2 影响跨部门权限、资源级权限
- P1-3 影响审批超时升级、并行审批

---

## v1.1.0 (待定) - 工作流引擎系统 🚀

### 新增功能

**工作流引擎（Phase 2-4）**:
- ✅ 基础工作流引擎（JSON 配置化）
- ✅ UI 可视化配置器（拖拽式设计）
- ✅ 并行审批（会签）
- ✅ 条件分支
- ✅ 子工作流
- ✅ 超时自动处理
- ✅ 审批人代理
- ✅ 工作流统计分析

**文档管理优化（Phase 1）**:
- ✅ 统一文档管理页面
- ✅ 部门筛选功能
- ✅ 级别筛选功能
- ✅ 组合筛选支持

### 技术改进

- ✅ 新增 8 个数据库表（工作流相关）
- ✅ 新增 WorkflowService 核心引擎
- ✅ 新增工作流可视化设计器
- ✅ 新增工作流统计分析页面

### 文档更新

- ✅ DESIGN.md 新增第十八章节
- ✅ 更新 CHANGELOG.md
- ✅ 更新 README.md
- ✅ 新增 WORKFLOW_CONFIG.md
- ✅ 更新 PROJECT_STRUCTURE.md

---

## v1.0.0 (2026-02-06) - 生产就绪版本 🎉

### 完成功能

**Phase 1-6（核心功能）**:
- ✅ 用户管理与组织架构
- ✅ 三级文档管理
- ✅ 审批流程
- ✅ 四级模板系统
- ✅ 任务派发与填报
- ✅ 通知系统

**Phase 7-8（配方偏离检测）**:
- ✅ 公差配置（范围/百分比）
- ✅ 自动偏离检测
- ✅ 偏离报告生成
- ✅ 偏离原因强制填写

**Phase 9（数据导出）**:
- ✅ Excel 批量导出
- ✅ 文档/任务/偏离报告导出
- ✅ 动态列支持

**Phase 10（二级审批）**:
- ✅ 二级审批流程（主管 → 经理）
- ✅ 审批链管理
- ✅ 驳回处理

**Phase 11（文件预览）**:
- ✅ PDF 原生预览
- ✅ Word/Excel 下载支持

**Phase 12（偏离统计）**:
- ✅ 偏离趋势分析
- ✅ 字段分布统计
- ✅ 部门偏离率
- ✅ 词云可视化

**其他功能**:
- ✅ 回收站功能

### 技术改进

- ✅ 版本号精度修复（Float → Decimal）
- ✅ Approval 表 CHECK 约束
- ✅ 安全评估完成
- ✅ 文档整理与精简

### 测试状态

- ✅ 20/20 测试套件通过
- ✅ 164/164 测试用例通过
- ✅ 85.3% 代码覆盖率

### 文档更新

- ✅ README.md 精简更新
- ✅ SECURITY.md 安全说明
- ✅ 删除临时完成报告
- ✅ 更新 CHANGELOG.md

---

## 历史版本

### 2026-02-06 - Phase 7-12 详细设计

- Phase 7-12 PRD + LLD 完成
- 偏离检测设计
- 数据导出设计
- 二级审批设计
- 文件预览设计
- 统计分析设计

### 2026-02-03 - 测试用例完善

- 新增 339 条功能测试用例
- 新增 62 条非功能测试用例
- 新增 120 条场景测试用例
- **合计**: 521 条测试用例

### 2026-02-01 - MVP Phase 1-6 开发计划

- MVP 范围定义（52个 Issue）
- 项目里程碑规划
- Monorepo + packages 结构

### 2025-01-31 - 项目初始化

- 项目结构创建
- 技术栈选型
- 初始文档编写

---

**维护原则**: 重要版本变更必须在此记录
