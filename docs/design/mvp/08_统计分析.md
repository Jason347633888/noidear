# 统计分析（Phase 12）

> **来源**: DESIGN.md 第十三章（Phase 12）  
> **文档版本**: 1.0  
> **最后更新**: 2026-02-14  
> **实现状态**: ✅ 已实现（MVP Phase 12, 98.1% 完成）  
> **代码位置**: `client/src/views/statistics/`

---

## 1. 功能概述

偏离统计分析系统，提供偏离趋势分析、字段分布统计、部门偏离率对比等可视化图表。

### 1.1 核心特性

- ✅ **偏离趋势分析**: 折线图展示偏离次数随时间变化
- ✅ **字段分布统计**: 饼图展示各字段偏离占比
- ✅ **部门偏离率**: 柱状图对比各部门偏离率
- ✅ **ECharts 图表**: 使用 ECharts 6.0+ 生成图表
- ✅ **数据筛选**: 支持按时间范围、部门、字段筛选

---

## 2. 统计图表

### 2.1 偏离趋势分析（折线图）

**数据来源**: `deviation_reports` 表，按 `reported_at` 分组

**图表类型**: ECharts Line Chart

**X 轴**: 日期（最近 30 天）  
**Y 轴**: 偏离次数

**示例代码**:
```typescript
const option = {
  title: { text: '偏离趋势分析（最近30天）' },
  xAxis: { type: 'category', data: ['2026-01-15', '2026-01-16', ...] },
  yAxis: { type: 'value' },
  series: [{
    data: [12, 8, 15, 7, 10, ...],
    type: 'line',
    smooth: true
  }]
}
```

### 2.2 字段分布统计（饼图）

**数据来源**: `deviation_reports` 表，按 `field_name` 分组

**图表类型**: ECharts Pie Chart

**示例代码**:
```typescript
const option = {
  title: { text: '偏离字段分布' },
  series: [{
    type: 'pie',
    data: [
      { value: 45, name: '温度' },
      { value: 30, name: '时间' },
      { value: 25, name: '数量' }
    ]
  }]
}
```

### 2.3 部门偏离率（柱状图）

**数据来源**: `deviation_reports` JOIN `users` JOIN `departments`

**图表类型**: ECharts Bar Chart

**X 轴**: 部门名称  
**Y 轴**: 偏离率（%）

**示例代码**:
```typescript
const option = {
  title: { text: '部门偏离率对比' },
  xAxis: { type: 'category', data: ['生产部', '质量部', '研发部'] },
  yAxis: { type: 'value' },
  series: [{
    data: [8.5, 3.2, 1.5],
    type: 'bar'
  }]
}
```

---

## 3. 数据筛选

**筛选条件**:
- 时间范围：最近7天 / 最近30天 / 自定义
- 部门：全部 / 指定部门
- 字段：全部 / 指定字段

---

**本文档完成 ✅**
