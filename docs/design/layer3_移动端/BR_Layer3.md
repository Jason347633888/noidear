# Layer 3 移动端 - 业务规则汇总

> **来源**: DESIGN.md 第二十章（移动端应用设计）  
> **文档版本**: 1.0  
> **最后更新**: 2026-02-14  
> **规则编号范围**: 无独立规则（复用 Layer 0-2 规则）  
> **规则总数**: 0 条（移动端主要遵循已有业务规则）

---

## 说明

移动端应用（Layer 3）本身不定义独立的业务规则，而是作为**执行层**复用和遵循 Layer 0-2 的业务规则。

### 移动端遵循的核心规则

| 规则来源 | 规则编号 | 规则内容 | 移动端实现方式 |
|---------|---------|---------|---------------|
| **Layer 0 基础设施** | BR-001 ~ BR-090 | 用户认证、权限控制、数据校验、文件上传、TodoTask 任务管理 | 调用后端 API，遵循统一规范 |
| **Layer 2 培训管理** | BR-091 ~ BR-115 | 培训计划、考试规则、待办任务 | 移动端提供培训考试界面、学员签到功能 |
| **Layer 2 内审管理** | BR-116 ~ BR-135 | 内审计划、审核执行、整改跟踪 | 移动端提供现场审核记录填写、拍照、签名 |
| **Layer 1 设备管理** | BR-181 ~ BR-230 | 设备维保、维保记录、设备报修 | 移动端提供维保记录填写、拍照、签名、报修提交 |

---

## 移动端特有功能规范（技术实现，非业务规则）

虽然移动端不定义业务规则，但有以下**技术实现规范**：

### 1. 离线填写规范

| 规范 | 说明 |
|------|------|
| **本地存储** | 使用 `uni.setStorageSync` 存储草稿数据 |
| **同步队列** | 离线填写的数据存入 `offlineQueue`，联网后自动同步 |
| **重试机制** | 同步失败时最多重试 3 次 |
| **冲突处理** | 服务器有更新时提示用户选择覆盖或保留本地数据 |

### 2. 文件上传规范

| 规范 | 说明 |
|------|------|
| **图片压缩** | 上传前自动压缩图片（最大 800px 宽度，质量 80%） |
| **缩略图生成** | 自动生成 200x200 缩略图 |
| **上传目标** | 所有文件上传到 MinIO（禁止存数据库） |
| **支持格式** | 图片（JPEG/PNG）、文档（PDF，仅预览不上传）、签名图片（PNG） |

### 3. 电子签名规范

| 规范 | 说明 |
|------|------|
| **签名组件** | 使用 Canvas 实现手写签字板 |
| **签名预览** | 签名完成后显示预览，支持重新签名 |
| **签名存储** | 签名转换为 PNG 图片上传到 MinIO |
| **签名验证** | 提交记录时校验签名图片存在且格式正确 |

### 4. 微信推送规范

| 规范 | 说明 |
|------|------|
| **推送类型** | 待办提醒、临期预警、审批通知 |
| **推送频率** | 每个用户每天最多推送 3 次相同类型的通知 |
| **推送时间** | 工作时间推送（8:00-18:00），非工作时间不推送 |
| **推送权限** | 用户可在设置中关闭推送通知 |

### 5. 动态表单渲染规范

| 规范 | 说明 |
|------|------|
| **支持字段类型** | text, number, textarea, date, time, datetime, select, multiselect, radio, checkbox, image, signature, scan（v2.0） |
| **表单布局** | 移动端采用单列布局（适配小屏） |
| **实时校验** | 输入时实时校验，显示错误提示 |
| **自动保存草稿** | 每 30 秒自动保存到本地存储 |

---

## 移动端与后端交互的 API 规范

移动端调用后端 API 时遵循以下规范：

| API 类别 | 规范要求 |
|---------|---------|
| **认证** | 所有请求必须携带 `Authorization: Bearer <token>` |
| **数据格式** | 请求和响应均使用 JSON 格式 |
| **错误处理** | 统一错误格式：`{ success: false, error: "错误信息" }` |
| **分页** | 列表查询支持 `page`、`limit` 参数 |
| **文件上传** | 使用 `multipart/form-data` 格式 |

---

## 移动端开发技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| uniapp | 最新版 | 跨平台开发框架 |
| Vue 3 | 最新版 | 前端框架 |
| uni-ui | 最新版 | UI 组件库 |
| Pinia | 最新版 | 状态管理 |
| TypeScript | 最新版 | 类型安全 |

---

**本文档完成 ✅**
